## 10-1-接口自动化怎么测试

( Python+ requests+pytest版本)

原来我们接口自动化是用 python+ request+ pytest执行

接口自动化其实主要就是接口测试的基础上填加了断言，参数化，动态关联

做接口自动化之前，我们也会划分模块，报告，公共的模块，测试数据，测试报告，主要的目的是为了方便后期的维护

测试数据，一般原来我们就是用的接口测试用例，公共的模块，主要是里面的一些公共的作，比如说用例 excel数据的读取

数据库的连接，还有我们封装的每个接口请求

断言的主要是获取访问接口的值判断，用的是 assert，参数化主要用的比较多是excel表格，就是测试用例数据

还有需要调用登录后的 cookies跟 token的时候，我们就会用到关联

比如说原来我们写的一个申请借款的接口吧

首先我们会编写测试用例，把每个用例数据保存到excel中

再建立一个申请借款的模块

这个时候我们去调用申请借款的功能模块，里面的参数我们是保存在 excel表格中

我们建立发送请求，通过参数化，去读写excel表格中的数据，获取到返回的数据，通过assert去对应返回的数据跟用例中异常的数据。

这个时候也会做数据库断言，去连接数据库去查询数据库中时候存在查询，如果是返回结果

是json数据格式，我们还会转化下格式后，再去断言

这个申请借款模块，也会用到登录的 cookie值 token，我们先建立一个登录的请求，提取

返回的 cookie值 token

excel表格多个用例，我们就用到循环去运行，读取excel中用例总的条数，去循环运行，

这里要注意的是:

就是excel表格数据时是str我们要eval转化成字典格式

把每个接口封装好以后

我们就会调用 pytest框架去运行所有test文件的测试用例

如果只是执行部分用例，也可以通过 pytest框架来指定

然后用 yagmail,在 pytest框架运行完test文件之后，发送邮件到指定邮箱。

接口自动化，我个人觉得，性价比是比较高的。

实现起来简单、维护成本低，容易提高覆盖率等特点

接口是稳定的，最多是增加一个字段或者新增接口之类的

低成本，有了相对的稳定性，不需要大量重新编写脚本，只需要基础维护包括用例的扩充就可以了

执行的快，反馈的速度快

（jmeter版本)

原来我们也做了很多接口自动化，接口自动化这块，其实原来我们也是用 jmeter请求去做的，这个时候，我们也用到一些工具，http代理，主要方便编写接口请求，通过录制就行了，我觉得接口自动化只是在接囗测试中多加了一些参数化、关联、断言参数，主要是函数参数化，自定义变量参数化，文件参数化，主要文件类型csv跟txt，不过原来csv文件用的比较多，还有一些数据库的参数化，断言，主要响应代码断言，响应文档断言。

比方说，原来我们一个登录接口主要是正常场，异常场票这块，正常场景，主要是用户跟密码正确，采用数据参数化，把用户名用随机函数进行参数化，随机长度大一些，用户名不存在的情况，原来是通过文件参数化，设置参数值，密码不正确也是通过文件参数化，接口请求中host地址，目录地址，我们都进行数据化，自定义变量去操作，结果检中，我们主要是用断言来检查，每个请求，

设置了2个断言，一个响应代码断言，一般是200，响应文本断言，登录成功，返回码为1

状态提示成功，检意是否成功，对应异常场景也是，都需要设置断言，去检查结果原来做的申请借款接口，需要登录接口http cookie，我需要建立2个接口，一个登录接口，一个申请借款接口，通过正则表达式去提取登录接口返回 cookie，在申请借款请求接口，设置http cookie时，值为登录接口返回cookie，还有也要考虑原来我们项目，还有 token值，提取登录返回 token，提取，当成申请借款的请求参数，当测试场景的脚本编写完成，执行接口测试用例，我们在察看结果树中，检直，主要是看颜色这块，红色检查哪些地方失败，绿色表示通过

编写完成后，我们会把脚本添加到 jenkins里面持续集成运行

原来我们持续集成是半个月运行一次，当然我们也可以手动构建

1，我们一般把写完的 jmeter的脚本

2，通过svn把写好的脚本检入到svn服务器

3，在 jenkins任务下，选择定时构建，或者手动构建，检查svn上传最新的脚本，去运行

一般我们项目在修改新的功能模块，上线，转测之前，都会自动去运行脚本

4，运行完成，我们再 jenkins下，查看脚本运行结果
